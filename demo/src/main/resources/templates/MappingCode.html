<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>ç³»çµ±ä»£ç¢¼ç¶­è­·</title>
<link rel="stylesheet" type="text/css" href="/css/MappingCode.css">
<script>
	function handleButtonClick(action) {
		const addBtn = document.getElementById('addBtn');
		const queryBtn = document.getElementById('queryBtn');
		const queryDataBtn = document.getElementById('queryDataBtn');
		const saveDataBtn = document.getElementById('saveDataBtn');
		const addFormSection = document.getElementById('addFormSection');
		const editFormSection = document.getElementById('editFormSection');

		// æ¯æ¬¡é»æŒ‰éˆ•å‰å…ˆå…¨éƒ¨å•Ÿç”¨
		addBtn.disabled = false;
		queryBtn.disabled = false;
		queryDataBtn.disabled = false;
		saveDataBtn.disabled = false;

		if (action === 'add') {
			// é¡¯ç¤ºæ–°å¢è¡¨å–®ï¼Œéš±è—ç·¨è¼¯è¡¨å–®
			addFormSection.style.display = 'block';
			editFormSection.style.display = 'none';
			queryDataBtn.disabled = true; // ç¦ç”¨æŸ¥è©¢è³‡æ–™æŒ‰éˆ•

			// ä½¿å„²å­˜æŒ‰éˆ•æœ‰æ•ˆ
			saveDataBtn.disabled = false;
		} else if (action === 'query') {
			// ç¦ç”¨å„²å­˜æŒ‰éˆ•
			saveDataBtn.disabled = true;
		} else if (action === 'edit') {
			// é¡¯ç¤ºç·¨è¼¯è¡¨å–®ï¼Œéš±è—æ–°å¢è¡¨å–®
			editFormSection.style.display = 'block';
			addFormSection.style.display = 'none';
			queryDataBtn.disabled = true; // ç¦ç”¨æŸ¥è©¢è³‡æ–™æŒ‰éˆ•

			// ä½¿å„²å­˜æŒ‰éˆ•æœ‰æ•ˆ
			saveDataBtn.disabled = false;
		}

		if (action === 'saveData') {
			let form;
			// æ ¹æ“šé¡¯ç¤ºçš„è¡¨å–®ä¾†é¸æ“‡ç›¸æ‡‰çš„è¡¨å–®
			if (addFormSection.style.display === 'block') {
				form = document.getElementById('addForm'); // æ–°å¢è¡¨å–®
			} else if (editFormSection.style.display === 'block') {
				form = document.getElementById('editForm'); // ç·¨è¼¯è¡¨å–®
			}

			if (form) {
				// é©—è­‰æ¬„ä½
				const codeType = document
						.getElementById(form.id === 'editForm' ? 'editCodeType'
								: 'codeType').value.trim();
				const codeNo = document
						.getElementById(form.id === 'editForm' ? 'editCodeNo'
								: 'codeNo').value.trim();
				const codeDesc = document
						.getElementById(form.id === 'editForm' ? 'editCodeDesc'
								: 'codeDesc').value.trim();

				if (codeType === '') {
					alert('è«‹å¡«å¯«ã€Œä»£ç¢¼é¡åˆ¥ã€');
					return; // ä¸é€å‡ºè¡¨å–®
				}

				form.submit(); // é€šéé©—è­‰å¾Œæäº¤è¡¨å–®
			} else {
				console.error('Form element not found!');
			}
		}

	}

	function editData(codeType, codeNo, codeDesc, codeSort, codeTag, codeFlag, forRowid) {
		const addFormSection = document.getElementById('addFormSection');
		const editFormSection = document.getElementById('editFormSection');

		// é¡¯ç¤ºç·¨è¼¯è¡¨å–®
		addFormSection.style.display = 'none';
		editFormSection.style.display = 'block';

		// å¡«è¡¨å–®
		document.getElementById('editCodeType').value = codeType;
		document.getElementById('editCodeNo').value = codeNo;
		document.getElementById('editCodeDesc').value = codeDesc;
		document.getElementById('editCodeSort').value = codeSort;
		document.getElementById('editCodeTag').value = codeTag;
		document.getElementById('editCodeFlag').value = codeFlag;
		document.getElementById('editForRowid').value = forRowid;

		// æŒ‰éˆ•ç‹€æ…‹
		document.getElementById('saveDataBtn').disabled = false;
		document.getElementById('addBtn').disabled = true;
		document.getElementById('queryBtn').disabled = true;
		document.getElementById('queryDataBtn').disabled = true;
	}
</script>
</head>
<body>
	<div class="button-container">
		<button id="addBtn" type="button" onclick="handleButtonClick('add')">æ–°å¢</button>
		<button id="queryBtn" type="button"
			onclick="handleButtonClick('query')">æŸ¥è©¢</button>
		<button id="queryDataBtn" type="button"
			onclick="handleButtonClick('queryData')">æŸ¥è©¢è³‡æ–™</button>
		<button id="saveDataBtn" type="button"
			onclick="handleButtonClick('saveData')">å„²å­˜è³‡æ–™</button>
	</div>
	<hr>
	<!-- ğŸ”½ æ–°å¢è¼¸å…¥å€å¡Š -->
	<div id="addFormSection" style="display: none; margin-top: 20px;">
		<form id="addForm" action="/MappingCode/save" method="post">
			<!-- è¨­ç½®ç‚º POST è«‹æ±‚ -->
			<table>
				<tbody>
					<tr>
						<td><label for="codeType">ä»£ç¢¼é¡åˆ¥ï¼š</label></td>
						<td><select name="codeType" id="codeType" class="form-select">
								<option value="">-- ä»£ç¢¼é¡åˆ¥ --</option>
								<option th:each="code : ${dropList}" th:value="${code.codeNo}"
									th:text="${code.codeDesc}"
									th:selected="${code.codeNo == codeType}"></option>
						</select></td>
						<td><label for="codeNo">ä»£ç¢¼ï¼š</label></td>
						<td><input type="text" id="codeNo" name="codeNo"></td>
					</tr>
					<tr>
						<td><label for="codeDesc">ä»£ç¢¼èªªæ˜ï¼š</label></td>
						<td><input type="text" id="codeDesc" name="codeDesc"></td>
						<td><label for="codeFlag">æ˜¯å¦åœç”¨ï¼š</label></td>
						<td><select id="codeFlag" name="codeFlag">
								<option value="N">å¦</option>
								<option value="Y">æ˜¯</option>
						</select></td>
					</tr>
					<tr>
						<td><label for="codeTag">ä»£ç¢¼æ¨™ç±¤ï¼š</label></td>
						<td><input type="text" id="codeTag" name="codeTag"></td>
						<td><label for="codeSort">æ’åºï¼š</label></td>
						<td><input type="number" id="codeSort" name="codeSort"></td>
					</tr>
				</tbody>
			</table>
		</form>
	</div>
	<br>
	<br>
	<!-- ğŸ”½ ä¿®æ”¹è¼¸å…¥å€å¡Š -->
	<div id="editFormSection" style="display: none; margin-top: 20px;">
		<form id="editForm" action="/MappingCode/update" method="post">
			<table>
				<tbody>
					<tr>
						<td><label for="editCodeType">ä»£ç¢¼é¡åˆ¥ï¼š</label></td>
						<td><input type="text" id="editCodeType" name="codeType"
							readonly></td>
						<!-- readonly ä»¥é˜²ç”¨æˆ¶ä¿®æ”¹ -->
						<td><label for="editCodeNo">ä»£ç¢¼ï¼š</label></td>
						<td><input type="text" id="editCodeNo" name="codeNo"></td>
					</tr>
					<tr>
						<td><label for="editCodeDesc">ä»£ç¢¼èªªæ˜ï¼š</label></td>
						<td><input type="text" id="editCodeDesc" name="codeDesc"></td>
						<td><label for="editCodeFlag">æ˜¯å¦åœç”¨ï¼š</label></td>
						<td><select id="editCodeFlag" name="codeFlag">
								<option value="N">å¦</option>
								<option value="Y">æ˜¯</option>
						</select></td>
					</tr>
					<tr>
						<td><label for="editCodeTag">ä»£ç¢¼æ¨™ç±¤ï¼š</label></td>
						<td><input type="text" id="editCodeTag" name="codeTag"></td>
						<td><label for="editCodeSort">æ’åºï¼š</label></td>
						<td><input type="number" id="editCodeSort" name="codeSort"></td>
					</tr>
					<!-- åŠ ä¸Šéš±è—æ¬„ä½ rowid -->
					<tr style="display: none;">
						<td><input type="hidden" id="editForRowid" name="rowid"></td>
					</tr>
				</tbody>
			</table>
		</form>
	</div>
	<br>
	<br>
	<!-- âœ… æ•´åˆæŸ¥è©¢æ¢ä»¶èˆ‡è¡¨æ ¼çš„è¡¨å–® -->
	<form action="/MappingCode" method="get">
		<!-- æŸ¥è©¢æ¢ä»¶ -->
		<select name="codeType"
			id="sysType" class="form-select">
			<option value="">-- ä»£ç¢¼é¡åˆ¥ --</option>
			<option th:each="code : ${dropList}" th:value="${code.codeNo}"
				th:text="${code.codeDesc}" th:selected="${code.codeNo == codeType}">
			</option>
		</select>
		<button type="submit">æŸ¥è©¢</button>
		<hr>
		<br>
		<!-- æŸ¥è©¢çµæœ -->
		<table th:unless="${#lists.isEmpty(codeList)}">
			<thead>
				<tr>
					<th></th>
					<th>ä»£ç¢¼é¡åˆ¥</th>
					<th>ä»£ç¢¼</th>
					<th>ä»£ç¢¼èªªæ˜</th>
					<th>æ’åº</th>
					<th>ä»£ç¢¼æ¨™ç±¤</th>
					<th>ä½¿ç”¨FLAG</th>
				</tr>
			</thead>
			<tbody>
				<tr th:each="code, iterStat : ${codeList}">
					<td>
						<button type="button"
							th:attr="onclick=|editData('${code.codeType}', '${code.codeNo}', '${code.codeDesc}', '${code.codeSort}', '${code.codeTag}', '${code.codeFlag}', '${code.forRowid}')|">
							ç·¨è¼¯</button>
					</td>
					<td th:text="${code.codeType}">ä»£ç¢¼é¡åˆ¥</td>
					<td th:text="${code.codeNo}">ä»£ç¢¼</td>
					<td th:text="${code.codeDesc}">ä»£ç¢¼èªªæ˜</td>
					<td th:text="${code.codeSort}">æ’åº</td>
					<td th:text="${code.codeTag}">ä»£ç¢¼æ¨™ç±¤</td>
					<td th:text="${code.codeFlag}">ä½¿ç”¨FLAG</td>
				</tr>
				<tr style="display: none;">
					<td><input type="hidden" id="editForRowid" name="forRowid"></td>
				</tr>
			</tbody>
		</table>
	</form>

</body>
</html>
