<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>æ¡ˆä»¶æ¸…å–®</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet" href="@{/css/CaseList.css}" />
</head>
<body>
	<div class="button-container"></div>
	<!-- ğŸ”½ æŸ¥è©¢è¼¸å…¥å€å¡Š -->
	<form id="searchForm" action="/CaseSearch" method="get">
		<div class="container-fluid mb-3">
			<div class="row g-3 align-items-end">
				<!-- é€²ä»¶æ—¥æœŸ -->
				<div class="col-md-4">
					<label for="caseInputStartDate" class="form-label">é€²ä»¶æ—¥æœŸï¼š</label>
					<div class="input-group">
						<input type="date" id="caseInputStartDate"
							name="caseInputStartDate" class="form-control"> <span
							class="input-group-text">~</span> <input type="date"
							id="caseInputEndDate" name="caseInputEndDate"
							class="form-control">
					</div>
				</div>

				<!-- æ”¶ä»¶ç·¨è™Ÿ -->
				<div class="col-md-4">
					<label for="applno" class="form-label">æ”¶ä»¶ç·¨è™Ÿï¼š</label>
					<div class="input-group">
						<span class="input-group-text" id="applno-label">ç·¨è™Ÿ</span> <input
							type="text" id="applno" name="applno" class="form-control"
							aria-describedby="applno-label">
					</div>
				</div>

				<!-- æŒ‰éˆ•å€å¡Š -->
				<div class="col-md-4 d-flex gap-2">
					<button type="button" class="btn btn-primary"
						onclick="searchButtonClick()">æŸ¥è©¢</button>
					<button type="button" class="btn btn-secondary"
						onclick="handleButtonClick('deleteData')">æ¸…ç©º</button>
				</div>
			</div>
		</div>
		<br> <br>
		<table id="caseListTable"
			class="table table-hover align-middle text-center">
			<thead class="table-light">
				<tr>
					<th>å–ä»¶</th>
					<th>æ¡ˆä»¶ç‹€æ…‹</th>
					<th>æ”¶ä»¶ç·¨è™Ÿ</th>
					<th>å®¢æˆ¶å§“å</th>
					<th>å®¢æˆ¶ID</th>
					<th>å¡åˆ¥</th>
					<th>è©æ¬ºé¡å‹</th>
					<th>é€²ä»¶æ—¥æœŸ</th>
				</tr>
			</thead>
			<tbody>
				<!-- JavaScript å‹•æ…‹æ¸²æŸ“ -->
			</tbody>
		</table>



	</form>
	<!-- jQuery & Bootstrap Bundle -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<!-- Thymeleaf å‚³å€¼è‡³ JavaScript -->
	<script th:inline="javascript">
    /*<![CDATA[*/
    const caseListData = (/*[[${caseList}]]*/ '[]');
    console.log(caseListData);
    /*]]>*/
  </script>

	<!-- å®¢è£½åŒ–åŠŸèƒ½ JS -->
	<script>
    // ä¸€é€²åˆ°é é¢å…ˆé¡¯ç¤ºæ‰€æœ‰è³‡æ–™
    document.addEventListener("DOMContentLoaded", () => {
      renderTable(caseListData);
    });

    // æ¸²æŸ“è³‡æ–™è¡¨æ ¼
    function renderTable(list) {
      const tbody = document.querySelector("#caseListTable tbody");
      tbody.innerHTML = "";

      list.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>
            <button type="button" 
                    class="btn btn-outline-primary btn-sm" 
                    onclick="openRoleDetailModal(this)" 
                    data-applno="${item.applno || ''}">å–ä»¶</button>
          </td>
          <td>${item.opDesc || ""}</td>
          <td>${item.applno || ""}</td>
          <td>${item.cuName || ""}</td>
          <td>${item.cuId || ""}</td>
          <td>${item.cardType || ""}</td>
          <td>${item.fraudType || ""}</td>
          <td>${item.caseInputTime || ""}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    // æŸ¥è©¢åŠŸèƒ½
    function searchButtonClick() {
      const applnoInput = document.getElementById("applno").value.trim();
      const startDateInput = document.getElementById("caseInputStartDate").value;
      const endDateInput = document.getElementById("caseInputEndDate").value;

      const filteredList = caseListData.filter(item => {
        const matchApplno = applnoInput === "" || (item.applno && item.applno === applnoInput);

        let itemDate = null;
        if (item.caseInputTime && item.caseInputTime.length >= 8) {
          const raw = item.caseInputTime;
          itemDate = `${raw.substring(0, 4)}-${raw.substring(4, 6)}-${raw.substring(6, 8)}`;
        }

        const matchStart = startDateInput === "" || (itemDate && itemDate >= startDateInput);
        const matchEnd = endDateInput === "" || (itemDate && itemDate <= endDateInput);

        return matchApplno && matchStart && matchEnd;
      });

      renderTable(filteredList);
    }

    // æ¸…ç©ºåŠŸèƒ½
    function handleButtonClick(action) {
      if (action === 'deleteData') {
        document.getElementById("applno").value = "";
        document.getElementById("caseInputStartDate").value = "";
        document.getElementById("caseInputEndDate").value = "";
        renderTable(caseListData);
      }
    }

    // å–ä»¶æŒ‰éˆ•
    function openRoleDetailModal(button) {
      const applno = button.getAttribute("data-applno");
      if (!applno) {
        alert("ç„¡æ³•å–å¾— applno");
        return;
      }
      window.location.href = `/Menu?applno=${encodeURIComponent(applno)}`;
    }
  </script>
</body>
</html>