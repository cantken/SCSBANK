<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>æ¡ˆä»¶æ¸…å–®</title>
<link rel="stylesheet" th:href="@{/css/CaseList.css}" />
</head>
<body>
	<div class="button-container"></div>
	<!-- ğŸ”½ æŸ¥è©¢è¼¸å…¥å€å¡Š -->
	<div id="searchFormSection" style="margin-top: 20px;">
		<form id="searchForm" action="/CaseSearch" method="get">
			<table>
				<tr>
					<td colspan="8">
						<div class="form-row">
							<!-- é€²ä»¶æ—¥æœŸ -->
							<div class="form-group">
								<label for="caseInputStartDate">é€²ä»¶æ—¥æœŸï¼š</label>
								<div class="date-range">
									<input type="date" id="caseInputStartDate"
										name="caseInputStartDate"> <span> ~ </span> <input
										type="date" id="caseInputEndDate" name="caseInputEndDate">
								</div>
							</div>

							<!-- æ”¶ä»¶ç·¨è™Ÿ -->
							<div class="form-group">
								<label for="applno">æ”¶ä»¶ç·¨è™Ÿï¼š</label> <input type="text" id="applno"
									name="applno">
							</div>

							<!-- æŒ‰éˆ•å€å¡Š -->
							<div class="button-group">
								<button type="button" onclick="searchButtonClick()">æŸ¥è©¢</button>
								<button type="button" onclick="handleButtonClick('deleteData')">æ¸…ç©º</button>
							</div>
						</div>
					</td>
				</tr>
			</table>
		</form>
	</div>
	<br>
	<br>
	<table id="caseListTable">
		<thead>
			<tr>
				<th>å–ä»¶</th>
				<th>æ¡ˆä»¶ç‹€æ…‹</th>
				<th>æ”¶ä»¶ç·¨è™Ÿ</th>
				<th>å®¢æˆ¶å§“å</th>
				<th>å®¢æˆ¶ID</th>
				<th>å¡åˆ¥</th>
				<th>è©æ¬ºé¡å‹</th>
				<th>é€²ä»¶æ—¥æœŸ</th>
			</tr>
		</thead>
		<tbody>

		</tbody>
	</table>
	<!-- jQuery & Bootstrap Bundle -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<script th:inline="javascript">
    /*<![CDATA[*/
    const caseListData = /*[[${caseList}]]*/ [];
    /*]]>*/
  </script>

	<script>
	function searchButtonClick() {
		  const applnoInput = document.getElementById("applno").value.trim();
		  const startDateInput = document.getElementById("caseInputStartDate").value; // yyyy-MM-dd
		  console.log("åŸå§‹ caseListDataï¼š", caseListData);
		  const endDateInput = document.getElementById("caseInputEndDate").value;     // yyyy-MM-dd

		  const filteredList = caseListData.filter(item => {
		    const matchApplno = applnoInput === "" || (item.applno && item.applno === applnoInput);

		    let itemDate = null;
		    if (item.caseInputTime && item.caseInputTime.length >= 8) {
		      // å°‡ "20250411 15:49:09" è½‰æˆ "2025-04-11"
		      const raw = item.caseInputTime;
		      itemDate = `${raw.substring(0, 4)}-${raw.substring(4, 6)}-${raw.substring(6, 8)}`;
		    }

		    const matchStart = startDateInput === "" || (itemDate && itemDate >= startDateInput);
		    const matchEnd = endDateInput === "" || (itemDate && itemDate <= endDateInput);

		    return matchApplno && matchStart && matchEnd;
		  });

		  renderTable(filteredList);
		}


    function renderTable(list) {
      const tbody = document.querySelector("#caseListTable tbody");
      tbody.innerHTML = "";

      list.forEach(item => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td><button type="button" class="btn btn-outline-primary btn-sm" onclick="openRoleDetailModal(this)">å–ä»¶</button></td>
          <td>${item.opDesc || ""}</td>
          <td>${item.applno || ""}</td>
          <td>${item.cuName || ""}</td>
          <td>${item.cuId || ""}</td>
          <td>${item.cardType || ""}</td>
          <td>${item.fraudType || ""}</td>
          <td>${item.caseInputTime || ""}</td>
        `;
        tbody.appendChild(tr);
      });
    }

    document.addEventListener("DOMContentLoaded", () => {
      renderTable(caseListData);
    });
  </script>
</body>
</html>