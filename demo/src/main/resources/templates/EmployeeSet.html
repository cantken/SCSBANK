<!DOCTYPE html>
<html lang="zh-TW" xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>çµ„ç¹”äººå“¡ç¶­è­·</title>
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
	rel="stylesheet">
<link rel="stylesheet" th:href="@{/css/EmployeeSet.css}">
</head>
<body>
	<div>
		<!-- æ–°å¢ç³»çµ±ä»£ç¢¼æŒ‰éˆ• -->
		<button id="addSystemCodeBtn" type="button" class="btn btn-primary"
			data-bs-toggle="modal" data-bs-target="#addModal">æ–°å¢å“¡å·¥è³‡æ–™</button>
		<br> <br>
	</div>
	<!-- ğŸ”½ æ–°å¢è¼¸å…¥å€å¡Š -->
	<div class="modal fade" id="addModal" tabindex="-1"
		aria-labelledby="addModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-xl">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title fw-bold" id="addModalLabel">æ–°å¢å“¡å·¥è³‡æ–™</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<form id="addForm" action="/EmployeeSet/save" method="post">
					<div class="modal-body">
						<div class="container-fluid">
							<div class="row g-2">
								<!-- å“¡å·¥ç·¨è™Ÿ -->
								<div class="col-md-6">
									<div class="form-floating">
										<input type="text" id="empNo" name="empNo"
											class="form-control" pattern="^\d{1,5}$" maxlength="5"
											title="è«‹è¼¸å…¥æœ€å¤š5ä½æ•¸å­—" required oninput="checkEmpNo(this)">
										<label for="empNo">å“¡å·¥ç·¨è™Ÿ</label> <span id="empNoError"
											class="text-danger small">è«‹è¼¸å…¥æœ€å¤š5ä½æ•¸å­—</span>
									</div>
								</div>

								<!-- å“¡å·¥å§“å -->
								<div class="col-md-6">
									<div class="form-floating">
										<input type="text" id="empName" name="empName"
											class="form-control" pattern="^[\u4e00-\u9fa5]{1,4}$"
											maxlength="4" title="è«‹è¼¸å…¥1è‡³4å€‹ä¸­æ–‡å­—" required
											oninput="checkEmpName(this)"> <label for="empName">å“¡å·¥å§“å</label>
										<span id="empNameError" class="text-danger small">è«‹è¼¸å…¥1è‡³4å€‹ä¸­æ–‡å­—</span>
									</div>
								</div>

								<!-- æ˜¯å¦åœ¨è· -->
								<div class="col-md-6">
									<div class="form-floating">
										<select id="onJob" name="onJob" class="form-select" required>
											<option value="" disabled selected>è«‹é¸æ“‡</option>
										</select> <label for="onJob">æ˜¯å¦åœ¨è·</label>
									</div>
								</div>

								<!-- å“¡å·¥ID -->
								<div class="col-md-6">
									<div class="form-floating">
										<input type="text" id="empId" name="empId"
											class="form-control" pattern="[A-Z][12][0-9]{8}"
											maxlength="10" required title="è«‹è¼¸å…¥æ­£ç¢ºçš„èº«åˆ†è­‰æ ¼å¼ï¼Œä¾‹å¦‚ A123456789"
											oninput="checkEmpId(this)"> <label for="empId">å“¡å·¥IDï¼ˆèº«åˆ†è­‰ï¼‰</label>
										<div id="empIdError" class="text-danger small"
											style="display: none;">èº«åˆ†è­‰æ ¼å¼ä¸æ­£ç¢ºï¼Œç¯„ä¾‹:A123456789</div>
									</div>
								</div>

								<!-- Email -->
								<div class="col-md-6">
									<div class="form-floating">
										<input type="email" id="email" name="email"
											class="form-control"
											pattern="^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$"
											title="è«‹è¼¸å…¥æ­£ç¢ºçš„ Email æ ¼å¼ï¼Œä¾‹å¦‚ example@mail.com" required
											oninput="checkEmail(this)"> <label for="email">E-MAIL</label>
										<span id="emailError" class="text-danger small"
											style="display: none;">Email æ ¼å¼ä¸æ­£ç¢ºï¼Œç¯„ä¾‹:
											example@mail.com</span>
									</div>
								</div>

								<!-- æ˜¯å¦åœæ´¾ -->
								<div class="col-md-6">
									<div class="form-floating">
										<select id="assignStop" name="assignStop" class="form-select">
											<option value="" disabled selected>è«‹é¸æ“‡</option>
										</select> <label for="assignStop">æ˜¯å¦åœæ´¾</label>
									</div>
								</div>

								<!-- è¦†å¯©Aé€ä»¶ä¸»ç®¡ -->
								<div class="col-md-6">
									<div class="form-floating">
										<select id="l2aEmpno" name="l2aEmpno" class="form-select">
											<option value="" disabled selected>è«‹é¸æ“‡</option>
										</select> <label for="l2aEmpno">è¦†å¯©Aé€ä»¶ä¸»ç®¡</label>
									</div>
								</div>

								<!-- è¦†å¯©Bé€ä»¶ä¸»ç®¡ -->
								<div class="col-md-6">
									<div class="form-floating">
										<select id="l2bEmpno" name="l2bEmpno" class="form-select">
											<option value="" disabled selected>è«‹é¸æ“‡</option>
										</select> <label for="l2bEmpno">è¦†å¯©Bé€ä»¶ä¸»ç®¡</label>
									</div>
								</div>

								<!-- æ´¾ä»¶å±¤ç´š -->
								<div class="col-md-6">
									<div class="form-floating">
										<select id="groupLevel" name="groupLevel" class="form-select">
											<option value="" disabled selected>è«‹é¸æ“‡</option>
										</select> <label for="groupLevel">æ´¾ä»¶å±¤ç´š</label>
									</div>
								</div>

							</div>
							<!-- row -->
						</div>
						<!-- container-fluid -->
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary btn-sm"
							onclick="handleButtonClick('saveData')">å„²å­˜è³‡æ–™</button>
					</div>
				</form>
			</div>
		</div>
	</div>

	<!-- ğŸ”½ ä¿®æ”¹è¼¸å…¥å€å¡Š -->
	<div class="modal fade" id="editModal" tabindex="-1"
		aria-labelledby="editModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-xl">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title fw-bold" id="editModalLabel">ä¿®æ”¹å“¡å·¥è³‡æ–™</h5>
				</div>
				<form id="editForm" action="/EmployeeSet/save" method="post">
					<div class="modal-body">
						<div class="container-fluid">
							<div class="row g-2">
								<div class="col-md-6">
									<div class="form-floating">
										<input type="text" id="editEmpNo" name="empNo"
											class="form-control" maxlength="5" required readonly>
										<label for="editEmpNo">å“¡å·¥ç·¨è™Ÿ</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-floating">
										<input type="text" id="editEmpName" name="empName"
											class="form-control" maxlength="4" required readonly>
										<label for="editEmpName">å“¡å·¥å§“å</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-floating">
										<select id="editOnJob" name="onJob" class="form-select"
											required>
											<option value="" disabled selected>è«‹é¸æ“‡</option>
										</select> <label for="editOnJob">æ˜¯å¦åœ¨è·</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-floating">
										<input type="text" id="editEmpId" name="empId"
											class="form-control" maxlength="10" required> <label
											for="editEmpId">å“¡å·¥IDï¼ˆèº«åˆ†è­‰ï¼‰</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-floating">
										<input type="email" id="editEmail" name="email"
											class="form-control" required> <label for="editEmail">E-MAIL</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-floating">
										<select id="editAssignStop" name="assignStop"
											class="form-select">
											<option value="" disabled selected>è«‹é¸æ“‡</option>
										</select> <label for="editAssignStop">æ˜¯å¦åœæ´¾</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-floating">
										<select id="editL2aEmpno" name="l2aEmpno" class="form-select">
											<option value="" disabled selected>è«‹é¸æ“‡</option>
										</select> <label for="editL2aEmpno">è¦†å¯©Aé€ä»¶ä¸»ç®¡</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-floating">
										<select id="editL2bEmpno" name="l2bEmpno" class="form-select">
											<option value="" disabled selected>è«‹é¸æ“‡</option>
										</select> <label for="editL2bEmpno">è¦†å¯©Bé€ä»¶ä¸»ç®¡</label>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-floating">
										<select id="editGroupLevel" name="groupLevel"
											class="form-select">
											<option value="" disabled selected>è«‹é¸æ“‡</option>
										</select> <label for="editGroupLevel">æ´¾ä»¶å±¤ç´š</label>
									</div>
								</div>
							</div>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-primary btn-sm"
							onclick="handleButtonClick('editData')">æ›´æ–°è³‡æ–™</button>
					</div>
				</form>
			</div>
		</div>
	</div>
	<!-- è§’è‰²è¨­å®šå½ˆçª— -->
	<div class="modal fade" id="roleDetailModal" tabindex="-1"
		aria-labelledby="roleDetailModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="roleDetailModalLabel">è¨­å®šè§’è‰²</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body" id="roleDetailContent">
					<!-- JavaScript æœƒå¡«å…¥é€™è£¡ -->
				</div>
				<div class="modal-footer">
					<div class="modal-footer">
						<button type="button" class="btn btn-primary btn-sm"
							id="saveRoleBtn">å„²å­˜è§’è‰²</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- é¡¯ç¤ºçµ„ç¹”äººå“¡ -->
	<div>
		<div class="container-fluid">
			<form th:action="@{/EmployeeSet/query}" method="get"
				onsubmit="event.preventDefault(); searchEmployee();">
				<div class="input-group mb-3" style="max-width: 300px;">
					<input type="text" id="empNoInput" class="form-control"
						placeholder="è«‹è¼¸å…¥å“¡å·¥ç·¨è™Ÿ" />
					<button class="btn btn-primary" type="submit">æŸ¥è©¢</button>
				</div>
				<table class="table table-hover align-middle text-center">
					<thead class="table-light">
						<tr>
							<th>æ“ä½œ</th>
							<th>å“¡å·¥ç·¨è™Ÿ</th>
							<th>å“¡å·¥å§“å</th>
							<th>å“¡å·¥ID</th>
							<th>æ˜¯å¦åœ¨è·</th>
							<th>E-MAIL</th>
							<th>æ˜¯å¦åœæ´¾</th>
							<th>è¦†å¯©Aé€ä»¶ä¸»ç®¡</th>
							<th>è¦†å¯©Bé€ä»¶ä¸»ç®¡</th>
							<th>æ´¾ä»¶å±¤ç´š</th>
							<th>è§’è‰²</th>
						</tr>
					</thead>
					<tbody id="employeeTableBody">
						<!-- AJAX å¡«å…¥ -->
					</tbody>
				</table>
			</form>
		</div>
	</div>
	<!-- Modal HTML å½ˆçª—æç¤ºæ”¾é é¢åº•éƒ¨ -->
	<div class="modal fade" id="saveResultModal" tabindex="-1"
		aria-labelledby="saveResultModalLabel" aria-hidden="true">
		<div class="modal-dialog modal-dialog-centered">
			<div class="modal-content">
				<div class="modal-body" id="saveResultMessage">å„²å­˜æˆåŠŸï¼</div>
				<div class="modal-footer">
					<button type="button" class="btn btn-secondary btn-sm"
						data-bs-dismiss="modal">é—œé–‰</button>
				</div>
			</div>
		</div>
	</div>

	<!-- jQuery & Bootstrap Bundle -->
	<script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
	<!-- Bootstrap JS (åŒ…å« Popper) -->
	<script
		src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

	<script>
	// æœå°‹è³‡æ–™
	function searchEmployee() {
	  const empNo = $('#empNoInput').val();
	  $.ajax({
	    url: '/EmployeeSet/query',
	    method: 'GET',
	    data: { empNo },
	    success: function(data) {
	      const employeeList = data.employeeList || [];
	      const tbody = $('#employeeTableBody');
	      tbody.empty(); // æ¸…ç©ºåŸæœ¬çš„è³‡æ–™
	
	      if (employeeList.length === 0) {
	        tbody.append('<tr><td colspan="11">æŸ¥ç„¡è³‡æ–™</td></tr>');
	        return;
	      }
	
	      employeeList.forEach(employee => {
	        const row = `
	          <tr>
	            <td>
	            <button type="button" class="btn btn-outline-secondary btn-sm"
	            	data-bs-toggle="modal" data-bs-target="#editModal"
	            	onclick="editData('${employee.empNo}', '${employee.empName}', '${employee.onJob}', '${employee.empId}', '${employee.email}', '${employee.assignStop}', '${employee.l2aEmpno}', '${employee.l2bEmpno}', '${employee.groupLevel}', '${employee.roleNo}')">
	            	ç·¨è¼¯
	            </button>
	              <button type="button" class="btn btn-outline-primary btn-sm mt-1"
	                data-emp-no="${employee.empNo}" onclick="openRoleDetailModal(this)">
	                è¨­å®šè§’è‰²
	              </button>
	            </td>
	            <td>${employee.empNo}</td>
	            <td>${employee.empName}</td>
	            <td>${employee.empId}</td>
	            <td>${employee.onJob}</td>
	            <td>${employee.email}</td>
	            <td>${employee.assignStop}</td>
	            <td>${employee.l2aEmpno}</td>
	            <td>${employee.l2bEmpno}</td>
	            <td>${employee.groupLevel}</td>
	            <td>${employee.roleNo}</td>
	          </tr>
	        `;
	        tbody.append(row);
	      });
	    },
	    error: function() {
	      alert("æŸ¥è©¢å¤±æ•—");
	    }
	  });
	}
	
	// é€šç”¨ä¸‹æ‹‰é¸å–®å¡«å…… function
	function populateDropdown(selectId, dataArray, valueField, textField) {
	  const select = document.getElementById(selectId);
	  select.innerHTML = '<option value="" disabled selected>è«‹é¸æ“‡</option>';
	  console.log("populateDropdown:", selectId, dataArray);
	  dataArray.forEach(item => {
	    const option = document.createElement("option");
	    option.value = item[valueField];
	    option.textContent = item[textField];
	    select.appendChild(option);
	  });
	}

	
	// å…ˆå®£å‘Šä¸€å€‹æš«å­˜è®Šæ•¸ï¼Œç”¨ä¾†å­˜ç•¶å‰ç·¨è¼¯çš„æ¬„ä½å€¼
	window.editingData = null;
	
	<!-- å‘¼å«ä¸‹æ‹‰é¸å–® -->
	function loadEmployeeSetDropdowns(callbackAfterLoad = null) {
	    fetch("/EmployeeSet/query")
	        .then(response => response.json())
	        .then(data => {
	            populateDropdown("onJob", data.codeYnDropList, "codeNo", "codeDesc");
	            populateDropdown("l2aEmpno", data.dropList1, "empNo", "empName");
	            populateDropdown("l2bEmpno", data.dropList2, "empNo", "empName");
	            populateDropdown("groupLevel", data.codeGroupLevelDropList, "codeNo", "codeDesc");
	            populateDropdown("assignStop", data.codeYnDropList, "codeNo", "codeDesc");

	            populateDropdown("editOnJob", data.codeYnDropList, "codeNo", "codeDesc");
	            populateDropdown("editL2aEmpno", data.dropList1, "empNo", "empName");
	            populateDropdown("editL2bEmpno", data.dropList2, "empNo", "empName");
	            populateDropdown("editGroupLevel", data.codeGroupLevelDropList, "codeNo", "codeDesc");
	            populateDropdown("editAssignStop", data.codeYnDropList, "codeNo", "codeDesc");

	            if (typeof callbackAfterLoad === "function") {
	                callbackAfterLoad();  // ç¢ºä¿åªæœ‰ç•¶å‚³å…¥å‡½å¼æ‰åŸ·è¡Œ
	            }
	        })
	        .catch(error => {
	            console.error("ç™¼ç”ŸéŒ¯èª¤ï¼š", error);
	        });
	}

	
	function setEditSelectValues() {
		  if (!window.editingData) return;
		  const data = window.editingData;

		  document.getElementById("editOnJob").value = data.onJob || "";
		  document.getElementById("editAssignStop").value = data.assignStop || "";
		  document.getElementById("editL2aEmpno").value = data.l2aEmpno || "";
		  document.getElementById("editL2bEmpno").value = data.l2bEmpno || "";
		  document.getElementById("editGroupLevel").value = data.groupLevel || "";
		}
	
	function editData(empNo, empName, onJob, empId, email, assignStop,
            l2aEmpno, l2bEmpno, groupLevel, roleNo) {
	    // è¨­å®š input æ¬„ä½
	    document.getElementById("editEmpNo").value = empNo;
	    document.getElementById("editEmpNo").readOnly = true;
	    document.getElementById("editEmpName").value = empName;
	    document.getElementById("editEmpId").value = empId;
	    document.getElementById("editEmail").value = email;
	
	    // æš«å­˜ select æ¬„ä½çš„å€¼
	    window.editingData = {
	        onJob, assignStop, l2aEmpno, l2bEmpno, groupLevel
	    };
	
	    // è¼‰å…¥ä¸‹æ‹‰é¸å–®ï¼Œè¼‰å…¥å®Œæˆå¾Œè¨­å®š select çš„å€¼
	    loadEmployeeSetDropdowns(function() {
	        setEditSelectValues();
	
	        // é¡¯ç¤º Modal
	        const myModal = new bootstrap.Modal(document.getElementById('editModal'));
	        myModal.show();
	    });
	}

	
	function handleButtonClick(action) {
		  if (action === "editData") {
		    // ä½ å¯ä»¥å¯«è¡¨å–®é©—è­‰ï¼Œæˆ–ç›´æ¥é€è¡¨å–®
		    document.getElementById("editForm").submit();
		  }
		}


	// å½ˆå‡ºè§’è‰²è©³ç´°è¦–çª—
	function openRoleDetailModal(button) {
	  const empNo = button.getAttribute('data-emp-no');
	
	  fetch(`/EmployeeSet/roleDetail?empNo=${empNo}`)
	    .then(response => {
	      if (!response.ok) throw new Error("Network response was not ok");
	      return response.json();
	    })
	    .then(data => {
	      const currentRoleNo = data.roleNoDto.roleNo;
	      const empNo = data.roleNoDto.empNo;
	
	      let html = `<input type="hidden" id="hiddenEmpNo" value="${empNo}">`;
	
	      data.roleDtoList.forEach(role => {
	        const isChecked = (role.roleNo === currentRoleNo) ? 'checked' : '';
	        html += `
	          <div class="form-check">
	            <input class="form-check-input" type="radio" name="selectedRole"
	              id="role${role.roleNo}" value="${role.roleNo}" ${isChecked}>
	            <label class="form-check-label" for="role${role.roleNo}">
	              ${role.roleName}
	            </label>
	          </div>
	        `;
	      });
	
	      document.getElementById("roleDetailContent").innerHTML = html;
	
	      const modalElement = document.getElementById("roleDetailModal");
	      const modal = new bootstrap.Modal(modalElement);
	      modal.show();
	
	      document.getElementById("saveRoleBtn").onclick = saveRole;
	    })
	    .catch(error => {
	      console.error("è¼‰å…¥è§’è‰²è©³ç´°è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:", error);
	      alert("è¼‰å…¥è§’è‰²è³‡æ–™å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚");
	    });
	}

	
	// é€å‡ºå“¡å·¥è³‡æ–™(æ–°å¢)
	function handleButtonClick(action) {
	  if (action === 'saveData') {
	    const form = document.getElementById('addForm');
	
	    if (!form.checkValidity()) {
	      form.reportValidity();
	      return;
	    }
	
	    const formData = new FormData(form);
	
	    fetch('/EmployeeSet/save', {
	      method: 'POST',
	      body: formData
	    })
	    .then(response => {
	      if (!response.ok) throw new Error('ä¼ºæœå™¨éŒ¯èª¤');
	      return response.text();
	    })
	    .then(data => {
	      // è¨­å®šè¨Šæ¯ä¸¦é¡¯ç¤ºæˆåŠŸå½ˆçª—
	      document.getElementById('saveResultMessage').textContent = 'å„²å­˜æˆåŠŸï¼';
	      new bootstrap.Modal(document.getElementById('saveResultModal')).show();
	
	      // é—œé–‰åŸæœ¬çš„æ–°å¢ Modal
	      const modal = bootstrap.Modal.getInstance(document.getElementById('addModal'));
	      if (modal) modal.hide();
	
	      // é‡ç½®è¡¨å–®
	      form.reset();
	
	      // å¦‚æœä½ è¦é‡æ•´è³‡æ–™
	      // location.reload();
	    })
	    .catch(error => {
	      console.error(error);
	      document.getElementById('saveResultMessage').textContent = 'å„²å­˜å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼';
	      new bootstrap.Modal(document.getElementById('saveResultModal')).show();
	    });
	  }
	}
	
	function handleButtonClick(action) {
		  if (action === "editData") {
		    const form = document.getElementById("editForm");

		    if (!form.checkValidity()) {
		      form.reportValidity();
		      return;
		    }

		    const formData = new FormData(form);

		    fetch("/EmployeeSet/save", {
		      method: "POST",
		      body: formData,
		    })
		      .then((response) => {
		        if (!response.ok) throw new Error("ä¼ºæœå™¨éŒ¯èª¤");
		        return response.text();
		      })
		      .then((data) => {
		        document.getElementById("saveResultMessage").textContent = "ä¿®æ”¹æˆåŠŸï¼";
		        new bootstrap.Modal(document.getElementById("saveResultModal")).show();

		        // é—œé–‰ç·¨è¼¯ Modal
		        const editModalEl = document.getElementById("editModal");
		        const editModal = bootstrap.Modal.getInstance(editModalEl);
		        if (editModal) editModal.hide();

		        // æ¸…é™¤ backdrop
		        document.querySelector(".modal-backdrop")?.remove();

		        form.reset();

		        // è‹¥è¦é‡æ•´é é¢ï¼Œè§£é™¤è¨»è§£ï¼š
		        // location.reload();
		      })
		      .catch((error) => {
		        console.error(error);
		        document.getElementById("saveResultMessage").textContent =
		          "ä¿®æ”¹å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ï¼";
		        new bootstrap.Modal(document.getElementById("saveResultModal")).show();
		      });
		  }
		}
	
	// å„²å­˜è§’è‰²è¨­å®š
	function saveRole() {
		  const empNo = document.getElementById("hiddenEmpNo").value;
		  const radios = document.getElementsByName("selectedRole");
		  let selectedRole = null;

		  for (const radio of radios) {
		    if (radio.checked) {
		      selectedRole = radio.value;
		      break;
		    }
		  }

		  if (!selectedRole) {
		    alert("è«‹é¸æ“‡ä¸€å€‹è§’è‰²");
		    return;
		  }

		  // å»ºç«‹è¦é€å‡ºçš„è³‡æ–™
		  const formData = new FormData();
		  formData.append("empNo", empNo);
		  formData.append("roleNo", selectedRole);

		  fetch("/EmployeeSet/role/save", {
		    method: "POST",
		    body: formData
		  })
		  .then(response => {
		    if (!response.ok) throw new Error("å„²å­˜å¤±æ•—");
		    return response.text();
		  })
		  .then(text => {
		    alert(text);
		    // å¦‚æœéœ€è¦ï¼Œå„²å­˜æˆåŠŸå¾Œå¯è‡ªå‹•é—œé–‰ modal
		    const modalElement = document.getElementById("roleDetailModal");
		    const modal = bootstrap.Modal.getInstance(modalElement);
		    modal.hide();
		  })
		  .catch(error => {
		    alert("å„²å­˜å¤±æ•—ï¼š" + error.message);
		  });
		}
		
	// ç¶å®šäº‹ä»¶
	document.getElementById("addSystemCodeBtn").addEventListener("click", function () {
	    loadEmployeeSetDropdowns();
	});

	</script>
</body>
</html>
